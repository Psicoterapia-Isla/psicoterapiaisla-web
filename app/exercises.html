<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ejercicio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/app.css">
</head>

<body class="app-body">

<nav class="app-menu">
  <a href="exercises.html">Volver</a>
  <a href="login.html">Salir</a>
</nav>

<main class="app-container">
  <h1 id="exercise-title"></h1>
  <p id="exercise-description"></p>

  <form id="exercise-form"></form>
</main>

<script type="module">
  import { requireAuth } from "./assets/js/auth.js";
  import { db } from "./assets/js/firebase.js";
  import {
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // 1️⃣ Comprobar login
  await requireAuth();

  // 2️⃣ Leer ID del ejercicio desde la URL
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  if (!id) {
    alert("Ejercicio no especificado");
    throw new Error("Falta ID");
  }

  // 3️⃣ Cargar ejercicio desde Firestore
  const ref = doc(db, "exercises", id);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    alert("Ejercicio no encontrado");
    throw new Error("No existe");
  }

  const exercise = snap.data();

  // 4️⃣ Pintar título y descripción
  document.getElementById("exercise-title").textContent = exercise.title;
  document.getElementById("exercise-description").textContent = exercise.description;

  // 5️⃣ Generar campos dinámicos
  const form = document.getElementById("exercise-form");

  exercise.fields.forEach(field => {
    const label = document.createElement("label");
    label.textContent = field.replace(/_/g, " ");

    const textarea = document.createElement("textarea");
    textarea.name = field;
    textarea.placeholder = "Escribe aquí…";

    form.appendChild(label);
    form.appendChild(textarea);
  });
</script>

</body>
</html>
