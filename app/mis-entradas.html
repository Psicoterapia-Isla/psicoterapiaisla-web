<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi diario terap√©utico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS global -->
  <link rel="stylesheet" href="assets/css/app.css">
</head>

<body class="app-layout">

<header class="app-menu"></header>

<main class="app-content">

  <h1>Mi diario terap√©utico</h1>

  <div class="card">
    <div id="entries"></div>
  </div>

</main>

<script type="module">
  import { requireAuth } from "./assets/js/auth.js";
  import { loadMenu } from "./assets/js/menu.js";
  import { auth, db } from "./assets/js/firebase.js";
  import {
    collection,
    query,
    where,
    orderBy,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üîê Auth + men√∫ (patr√≥n √∫nico)
  await requireAuth();
  await loadMenu();

  /* =========================
     CARGAR ENTRADAS DE DIARIO
  ========================= */
  const q = query(
    collection(db, "entries"),
    where("uid", "==", auth.currentUser.uid),
    where("type", "==", "diario"),
    orderBy("createdAt", "desc")
  );

  const snap = await getDocs(q);
  const container = document.getElementById("entries");

  if (snap.empty) {
    container.innerHTML = "<p>No hay entradas todav√≠a.</p>";
  } else {
    snap.forEach(docSnap => {
      const d = docSnap.data();

      const entry = document.createElement("div");
      entry.className = "card";
      entry.style.marginBottom = "16px";

      entry.innerHTML = `
        <small style="opacity:0.7">
          ${d.createdAt?.toDate
            ? d.createdAt.toDate().toLocaleString()
            : ""}
        </small>
        <p style="margin-top:8px">${d.texto || ""}</p>
      `;

      container.appendChild(entry);
    });
  }
</script>

</body>
</html>
